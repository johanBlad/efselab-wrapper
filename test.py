# -*- coding: utf-8 -*-

from efselabwrapper.pipeline import run_processing_pipeline, run_annotation_pipeline

def test_pipelines():
    corpus = TEST_CORPUS
    print('test annotation pipeline...')
    annotated = run_annotation_pipeline(corpus)
    print('len & output: ', len(annotated), annotated[0][:3], '...\n')

    print('test processing pipeline...')
    processed = run_processing_pipeline(corpus)
    print('len & output: ', len(processed), processed[0][:3], '...\n')

    print("test complete!")


DOC1 = '''
Flera personrån vid gröna linjen – polisen ökar närvaron\n\nPå senare tid har flera unga rånats kring biljetthallarna längs med gröna linjen. Polisen har därför utökat närvaron på tunnelbanestationerna.\n\nPolisen i Vällingby skriver på sin Facebook-sida att brottsoffren är väldigt unga. Rånarna har under, enligt polisens benämning, hotfulla situationer tillgripit bland annat kläder och mobiltelefoner.\nRånen har skett i direkt anslutning till biljetthallar längs med tunnelbanans gröna linje.\nI brottsförebyggande syfte har därför polisen utökat sin närvaro vid tunnelbanestationerna. Man har också samtalat med ungdomar och vuxna. Nyligen fanns man på plats vid Alviks t-banestation.\nKommunpolisen Matti Rönnqvist säger till Stockholm Direkt att ungdomsrånen i Västerort eskalerade hösten 2018 men att polisen då lyckades bryta trenden.\n– Vi lyckades bryta det som höll på att bli en rånvåg. Nu har vi en yttre grupp som kör på femton minuters-metoden, där vi besöker de olika stationerna och snackar med både ungdomar och vuxna på plats, säger han till tidningen.\n
'''

DOC2 = '''
Häktad för grov våldtäkt släppt efter en timme\n\nDen 21-åring som på måndagen häktades på sannolika skäl misstänkt för den grova våldtäkten i Hässelby släpptes ur häktet efter en timme. Åklagaren motiverar beslutet med att ”nya uppgifter har framkommit”.\n– Det måste ha varit historiens kortaste häktning, säger 21-åringens advokat Erik Nydert.\n\nKlockan 15.40 på måndagen avslutades en häktningsförhandling i Solna tingsrätt. Då beslutade tingsrätten att häkta en 21-årig man, på sannolika skäl misstänkt för den grova våldtäkt som ska ha begåtts i en lägenhet i Hässelby natten mellan torsdagen och fredagen i förra veckan.\nSannolika skäl är den starkare misstankegraden.\nMen klockan 16.35 beslutade kammaråklagare Leonardo Roseneld att häva häktningsbeslutet.\n”Nya uppgifter har efter dagens häktningsförhandling framkommit. Dessa uppgifter gör att misstankegraden beträffade den misstänkte har försvagats och att sannolika skäl inte längre föreligger”, skriver åklagaren i sitt beslut.\nAdvokat Erik Nydert försvarar 21-åringen:\n– Min klient är oskyldig och har alibi. Det är kanske alibit man har kontrollerat efter att han häktats. Jag har inte fått besked om exakt varför åklagaren beslutade att häva häktningen.\nVad säger det om hur polisutredningen hittills gått till?\n– Det är tråkigt att det uppenbart skett flera misstag. Enligt min uppfattning så hade polisen kunnat göra mycket mer under de dagar som gått. Polisen har haft svårt att få tag i folk för att kontrollera vissa vittnesmål, men samtidigt fanns det åtgärder de hade kunnat vidta mycket tidigare än vad som skett, säger Erik Nydert.\nKammaråklagare Leonardo Roseneld vill inte kommentera vilka konkreta uppgifter som enligt åklagaren ”av en händelse” kom fram först efter att mannen häktades i går.\n– Det som kom fram måste kontrolleras ytterligare. Uppgifterna i sig gjorde dock att misstankegraden sjönk och därför beslutade jag att häva häktningsbeslutet. Formellt är 21-åringen fortfarande misstänkt, säger han.\nEnligt Leonardo Roseneld har polisen säkrat spår, tagit saker i beslag och hört en rad vittnen i ärendet. Han vill dock inte kommentera bevisläget och det faktum att nu har tre personer som varit frihetsberövade i ärendet släppts.\n– Utredningen fortsätter och läget förändras kontinuerligt.\nDet är, enligt rättens ordförande, rådman Anders Samuelsson, mycket sällsynt att en person som häktas på sannolika skäl försätts på fri fort så snart.\n– Häktningsförhandlingen hölls bakom stängda dörrar så jag kan inte gå in på några detaljer, säger han.\nEn 18-åring kvinna sitter sedan i lördags häktad misstänkt för medhjälp till grov våldtäkt i det aktuella fallet. Under helgen släpptes två andra män, en 20-åring och en 43-åring, som varit frihetsberövade i ärendet släppts.\n
'''

DOC3 = '''
Jerker Virdborg: Och Enebyberg försvinner bakom mig, hastigt\n\nStig Dagerman tog sitt liv i det egna garaget, 1954. Jerker Virdborg har besökt garaget i förorten Enebyberg. Han vet själv inte riktigt varför. Det var tvunget.\n\nTågresan från Östra station tar tretton minuter. När jag kliver av i Enebyberg visar termometern fem grader minus. Men det känns som femton.\nJag lämnar perrongen och gör åkarbrasor medan jag går. Det är decemberkväll. Villagatorna runt stationsområdet ligger i mörker, det enda som syns är gulvita sken från gatlyktorna. Jag tar mig uppför en lång stentrappa och avverkar en kort backe. Och så är jag där.\nFenixvägen. Den är fullständigt öde, precis som alla angränsande gator. Min andedräkt ser ut som cigarrettrök. Jag tittar mig huttrande omkring och viskar sedan, rakt ut i kölden: ”Vad gör jag här?”\nGaraget, ett fristående, var ursprungligen brunsvart. Och har senare flyttats. Med grunden och allt. Men, det intygade man mig, det finns kvar.\xa0\nJag irrar runt, försöker hitta rätt sidogata. Och under tiden anar jag högst upp på berget den mäktiga Tornvillan med sitt brutna tak. Bakom spröjsverket i tornrummets – skrivrummets – bågfönster glimmar en adventsstjärna. Men särskilt mycket skrivet därinne blev det ju inte.\nAmos Oz: Jag känner mig djupt förbunden med Stig Dagermans sätt att tänka\xa0\nEtt stycke bort, snett bakom ett ljusgrönt hus, på en helt annan tomt, skymtar en liten byggnad. Jag drar min korta rock tätt om kroppen. Byggnaden är högst fem gånger nio meter. Är det verkligen – den?\nI november 1954 hade garaget jordgolv. Och dubbeldörrar på båda gavlarna. Inga fönster. Plats för bara en bil, en engelsk, en Austin A70 Hereford Saloon med elegant svängda stänkskärmar och två klotrunda strålkastare på den rikligt förkromade fronten.\nTvekande går jag in på tomten och fram till garaget. Jo, det är rätt. Men inte brunsvart, hinner jag tänka, utan vitt, innan jag lägger handen på dörrhandtaget. Och stiger in.\xa0\n\nJag har fått höra att vissa stämningar i mina egna böcker kan påminna om Stig Dagermans fiktiva världars.()\n\nDärinne är det tjugo grader varmt. Väggarna täcks av välhyvlade vitlaserade plankor. I hörnet finns en bred soffa med randiga kuddar, på golvet en mjuk yllematta och i änden en sovalkov med tjocka täcken. En inredningsterm kommer för mig: New England.\nJag ställer mig vid långväggen och försöker frammana hur det såg ut härinne en helt annan kväll, torsdagen den 4 november 1954. Austinmotorn var då avstängd och nycklarna satt inte i tändningslåset. Men den vänstra framdörren stod öppen och… Jag avbryter tankegången och stirrar ut genom altandörren, ut i vintermörkret. Vad håller jag på med? \xa0\nStig Dagermans författarskap tycks mig ojämnt. Jag har fått höra att vissa stämningar i mina egna böcker kan påminna om hans fiktiva världars. Men hur högt jag än rankar romanen ”Bränt barn” eller novellen ”Att döda ett barn” hör han inte till mina självklara favoriter. Så, står jag verkligen här? På riktigt?\nJag stirrar mot en viss del av mattan.\n”Den döda kroppen låg i framsätet på förarplatsen”, står det i utredningen signerad assistent Carl Bergman vid Danderydspolisen. ”Kroppen var liggande med ryggen mot sätet och benen samt nedre delen av underkroppen ut genom den öppna vänstra främre bildörren. Fötterna stödde mot golvet. Några tecken till yttre våld kunde icke upptäckas /…/ Nyckeln anträffades sedermera under den döda kroppen i framsätet.”\nPlath, Mishima, Benedictsson, Kane, Strunge, Woolf… Alla dessa författarsjälvmord som exploaterats och mytologiserats av både media och den internlitterära subkulturen, kan man hitta en metafor för den processen?\n\nFast, varför åkte jag hit? Det vet jag fortfarande inte.()\n\nKanske som ett förgiftat iskallt trägarage, med jordgolv, som efter hand byggs om till ett mysigt vältempererat Attefallshus i New England-stil?\xa0\nSedd utifrån är den lilla byggnaden också intill förväxling lik vilka andra friggebodar som helst, utanför tusentals snarlika svenska villor. Och bakom tacksamt romantiserbara myter om så kallade olyckliga genier och deras hjärtskärande dödslängtan finns gång på gång mycket krassa berättelser om outhärdliga sjukdomar, förlamande oförmåga att arbeta eller känslor av intensiv meningslöshet och akut existentiell klaustrofobi. Varav inget är förbehållet enbart författare eller andra konstnärssjälar. \xa0\nHög tid att lämna garaget. Medan jag går tillbaka mot stationen tänker jag på Werner Aspenström, som i en essä beskrev Dagerman som en spelarnatur, som trivdes med höga insatser, som gärna ville befinna sig nära faran för att på så sätt förhöja livets värde. Det däremot är, på långt avstånd från alla tänkbara självmord, en fullt begriplig och djupt trösterik författarhållning.\xa0\nJerker Virdborg: Jag borde inte prata såhär om bokbranschen på lokal, sa hon\xa0\nFast, varför åkte jag hit? Det vet jag fortfarande inte. Och det spelar inte heller någon roll. Men jag var, faktiskt, tvungen.\nPendeltåget på väg in mot city kommer äntligen, med snön yrande längs hjulen, och när jag stiger in i den halvfulla kupén omsluts jag genast av värme. Och Enebyberg försvinner bakom mig, hastigt.\xa0\nDet var rätt att åka dit. Men återvända kommer jag aldrig.\n
'''

DOC4 = '''
Nya Zeelands regering överens om skärpta vapenlagar\n\nNya Zeelands premiärminister Jacinda Ardern säger att landets koalitionsregering är överens om åtgärder för att skärpa landets vapenlagar. Troligen kommer det att presenteras före nästa regeringsmöte på måndag.\n\n– Vi har fattat ett beslut som regering, vi är enade, säger Ardern vid en presskonferens.\nArdern uppger att principiella beslut har fattats och förändringarna ska tillkännages nästa vecka. ”Fullständigt enade”, beskriver hon regeringen som är en koalition av hennes socialdemokratiska Labour, högerpopulistiska NZ First och Green Party of Aotearoa NZ.\xa0\nVice premiärminister Winston Peters, vars parti New Zealand First tidigare motsatt sig skärpta vapenlagar, stod vid Arderns sida under presskonferensen.\n– Verkligheten är att klockan ett i fredags eftermiddag förändrades vår värld för alltid och det måste också våra lagar, sade han.\nFlera försök har gjorts att skärpa vapenlagarna i Nya Zeeland under 2000-talet. Det finns en och en halv miljon skjutvapen i Nya Zeeland – vars befolkning uppgår till fem miljoner. Vid 16 års ålder kan en nyzeeländare få sin första licens och 18-åriga får äga halvautomatiska vapen.\xa0\nDen misstänkte Christchurch-terroristen Brenton Tarrant, 28, är ursprungligen från Grafton, Australien, och landets antiterrorpolis genomförde husrannsakningar på två adresser i samma delstat, New South Wales, på måndagen. Tarrant har avskedat sin advokat och ska företräda sig själv i domstol.\nDet har väckt oro för att Tarrant kan komma att utnyttja kommande rättegång för att försöka föra ut extrema åsikter. Därför förordar somliga bedömare att åklagarna att i stället åberopa mord, det skulle bli en kortare rättegång och mindre risk för hans utspel såväl som för att anhöriga ska uppleva mer trauman.\nTarrants tidigare advokat, Richard Peters, säger till tidningen att Tarrant verkar vara mentalt stabil. Peters säger att hans uppdrag att företräda Tarrant avslutades i lördags.\nPå måndagen framträdde en 18-åring i nyzeeländsk domstol anklagad för att ha spridit en film från dådet vid al Noor-moskén i Christchurch. 18-åringen ska även ha publicerat en bild från moskén med texten: ”mål avklarat”.\n18-åringen riskerar 14 års fängelse för varje åtalspunkt.\nLäs mer: Nyzeeländare bunkrar vapen efter löfte om lagskärpning\nLäs mer: Abdul jagade bort skytten med en kortläsare\nDetta vet vi: Antimuslimska terrordådet i Nya Zeeland\n
'''

DOC5 = '''
Uppgifter: IS-rekryteraren Michael Skråmo gripen i Syrien\n\nDen kände IS-rekryteraren och terroristen Michael Skråmo har gripits av kurdiska styrkor i Syrien, uppger en källa inom den kurdiska YPG-milisen för DN.\xa0\nDen norska säkerhetspolisen uppger nu att en förundersökning inletts, rapporterar SVT.\xa0\n– Att han är gripen levande betyder mycket. Han är en av dem som stridit in i det sista, och han sitter på mycket information. Nu kommer han att förhöras, säger källan inom YPG.\n\nMichael Skråmo ska ha gripits under strider i terroristsekten IS sista syriska fäste Baghouz, vilket SVT Nyheter och Expressen var först att rapportera. Även den svenske YPG-soldaten Jesper Söder twittrar att Michael Skråmo har gripits. Uppgifterna har inte bekräftats officiellt av den kurdiska YPG-milisen.\nPå måndagen rapporterade oppositionsgruppen Syriska människorättsobservatoriet, SOHR, att 150 stridande IS-medlemmar i Baghouz gett upp.\xa0\n– Michael Skråmo är gripen, och det skedde i går, måndag, säger en källa inom YPG till DN.\nEn officiell talesperson för kurdiska YPG skriver på Twitter att 3.500 personer under tisdagen evakuerats från Baghouz, 500 av dem uppges vara kapitulerande IS-medlemmar.\nSvenska säkerhetspolisen och UD kan inte kommentera om Michael Skråmo har gripits av de kurdiska styrkorna.\n– När det gäller svenskar som är gripna utomlands är det inte en fråga för Säkerhetspolisen, säger Sofia Hellqvist, pressekreterare på Säpo till DN.\nSkråmo är norsk medborgare men har under en längre tid varit bosatt i Sverige. 2014 anslöt han sig till terrororganisationen IS och reste från Göteborg till Syrien tillsammans med sin fru och parets då fyra barn. Paret har fått ytterligare tre barn under tiden de visats i Syrien. Nyligen rapporterade den islamismgranskande stiftelsen Doku att Skråmos fru har dödats.\n– Hans barn är också omhändertagna. Han hade sju barn med sig. Deras mamma dog för några veckor sedan. En annan kvinna från IS har tagit hand om dem så länge. Nu tar vi hand om barnen. Vi har redan flera andra svenska barn från terrorister som vi tagit hand om, säger DN:s källa inom YPG.\nUnder familjens första tid i Syrien fick de både barn- och bostadsbidrag utbetalt av Försäkringskassan, vilket Expressen avslöjade tillsammans med Doku hösten 2016. Familjen ska ha fått ut omkring 5.000 kronor under som mest åtta månaders tid, innan de svenska myndigheterna avregistrerade dem.\nDen norska säkerhetspolisen, PTS, uppger nu att en förundersökning om deltagande i terrororganisation har inletts.\n– Han är misstänkt för att ha deltagit i en terrororganisation. Men jag vill inte säga exakt när förundersökningen inleddes, säger PST:s kommunikationschef Trond Hugubakken till SVT.\n– Han är en norsk medborgare som vi har efterlyst internationellt för deltagande i en terrororganisation, säger han till den norska tidningen VG.\xa0\nHuruvida Norge planerar att försöka få sin medborgare utlämnad till landet är ännu osäkert.\n– Vi måste få en officiell bekräftelse på att Michael Skråmo är gripen och vem som har gripit honom. Sedan får vi se hur vi går vidare. Just nu kan jag inte säga mer, säger Trond Hugubakken till SVT.\nMagnus Ranstorp, terrorforskare vid Försvarshögskolan, tror att det finns möjligheter för både norska och svenska myndigheter att åtala Michael Skråmo.\n– Eftersom han uppmanat och gjort försök till rekrytering, säger Magnus Ranstorp.\nHan har själv följt Michael Skråmos propaganda via appen Telegram.\n– Han är en person som uppmanat till terror. Han har varit väldigt publik eftersom han lagt upp väldigt mycket propaganda.\nMagnus Ranstorp lyfter vikten av att sociala myndigheter engagerar sig i situationen för Michael Skråmos sju barn.\n– De är väldigt utsatta, mamman är död, de är under tio år och oskyldiga.\nHan menar att de svenska sociala myndigheterna inte har varit tillräckligt förberedda på hur de ska hantera frågan med barnen till svenska IS-medlemmar.\n– I Nederländerna har man tagit fram individuella planer för barnen till alla personer som anslutit sig till IS. Men den svenska socialtjänsten har inte gjort någonting sådant.\nDN söker kurdiska YPG.\nNiklas Orrenius: De svenska IS-terroristerna rekryterades inte i Syrien utan i Sverige\n
'''

TEST_CORPUS = [
    DOC1,
    DOC3,
    DOC3,
    DOC4,
    DOC5,
]

if __name__ == '__main__':
    test_pipelines()